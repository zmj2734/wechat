<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>登 录</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <link href="../../css/mui.min.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="../../css/iconfont.css" />
    <link rel="stylesheet" type="text/css" href="../../css/app_new.css" />
    <script type="text/javascript" src="../../js/jquery-3.1.0.min.js"></script>
    <script type="text/javascript" src="../../js/mui.min.js"></script>
    <script type="text/javascript" src="../../js/common.js"></script>
    <style>
        html,body{
            height: 100%;
        }
        .mui-content {
            background: white!important;
        }
        #fromHerf{
            font-size: 14px !important;
        }
        .mui-input{
            font-size: 16px !important;
        }
        #checkboxID{
            width: 15px;
            height: 15px;
        }
        .mui-position-bottom{
            width: 100%;
            position: absolute;
            bottom: 0;
            text-align: center;
        }
        .mui-position-bottom p{
            margin-top: 0;
            font-size: 16px;
            line-height: 18px;
            color: #777;
        }
        .mui-position-bottom p.p_2{
            font-size: 14px;
            line-height: 12px;
            margin-top: 12px;
            margin-bottom: 12px;
            /*color: #ccc;*/
        }
        .checked{
            width: 16px;
            height: 16px;
            display: inline-block;
            background: url(../../img/icon-false.png) no-repeat;
            background-size: 16px 16px;
        }
        .checked-bg{
            width: 16px;
            height: 16px;
            display: inline-block;
            background: url(../../img/icon-true.png) no-repeat !important;
            background-size: 16px 16px !important;
        }
        .login_txt{
            position: absolute;
            top: 0px;
            left: 0;
            width: 16px;
            height: 16px;
            opacity: 0;
        }
        .login_txt input{
            width: 16px !important;
            height: 16px !important;
        }
        .xieyi{
            position: relative;
        }
        .xieyi span,label{
            font-size: 16px !important;
        }
        .ul{
            margin-top: 0 !important;
        }
        .mui-content{
            height: 100%;
            position: relative;
        }
    </style>
    <script>
        var uuid = null;
        var auid = null;
        var checId = false;
        var phoneCheck = true ;
        $(function() {

            $("#login").css("background-color", "#007AFF");
            $("#up_send").click(function() {
                $("input").blur();
                if(!phoneCheck){
                    return ;
                }
                var phone = document.getElementById("phone").value;
                if(!booking.validate_mobile(phone)) {
                    mui.toast("手机号码输入有误，请重试");
                    return;
                }
                var send = document.getElementById("up_send");
                booking.smsTime_new(send);
                mui.app_request('POST', {
                    "OPERATE_TYPE": "10001",
                    "MOBILE": phone,
                    "B_TYPE": "10"
                }, function(data) {
                    if(data.RESULTCODE == "0") {
                        uuid = data.RESULTLIST.UUID;
                    }
                    return;
                }, function(data) {
                    if(data.RESULTCODE == "-1") {
                        mui.toast(data.DESCRIPTION);
                    } else {
                        mui.toast("系统异常，请重试！");
                    }
                    return;
                });

            })
            //checked
            $("#checked").click( function() {
                var checked = document.getElementById("checkboxID").checked;
                if(checked){
                    $(".checked").addClass("checked-bg");
                }else{
                    $(".checked").removeClass("checked-bg");
                }
            })

            $("fromHerf").click( function() {
                $("input").blur();
                //mui.openWindow("login_agree.html","login_agree");
                mui.openWindow({
                    id: 'login_agree',
                    url: 'login_agree.html',
                    extras: {
                        backId: "login"
                    }
                });
            })

            //登录的点击事件
            $("#login").click( function() {
                //alert("a");
                $("input").blur();
                if(!phoneCheck){
                    return ;
                }
                var phone = document.getElementById("phone").value;
                var code = document.getElementById("code").value;
                var recommand = document.getElementById("recommend").value;
                var checId = document.getElementById("checkboxID").checked;

//					if(checId == "false") {
//						mui.toast("请查看并确认协议");
//						remDisabled("login");
//						return;
//					}
                if(!booking.validate_mobile(phone)) {
                    mui.toast("手机号有误请重试");
                    remDisabled("login");
                    return;
                }
                if(mui.isnull(code)) {
                    mui.toast("验证码不能为空");
                    remDisabled("login");
                    return;
                }
                if(mui.isnull(uuid)) {
                    mui.toast("请先发送验证码");
                    remDisabled("login");
                    return;
                }
                if(!mui.isnull(recommand)) {
                    if(!booking.validate_mobile(recommand)) {
                        mui.toast("推荐人手机号有误");
                        remDisabled("login");
                        return;
                    }
                }
                if(checId==false) {
                    mui.toast("请阅读并勾选注册协议");
                    remDisabled("login");
                    return ;
                }
                setDisabled("login");
                mui.app_request('POST', {
                    "OPERATE_TYPE": "10002",
                    "MOBILE": phone,
                    "SMS_CODE": code,
                    "RECOMMAND_USER": recommand,
                    "UUID": uuid
                }, function(data) {
                    if(data.RESULTCODE == "0") {
                        remDisabled("login");
                        mui.toast("登录成功");
                        localStorage.setItem("auid", data.RESULTLIST.AUTH_ID);
                        localStorage.setItem("istrue",false);
                        uuid = null;
                        //mui.cacheUser.uploadPushInfo();
                        mui.openWindow(
                            '../index/index.html',
                            'index'
                        )
                    }

                    remDisabled("login");
                    return;
                }, function(data) {
                    if(data.RESULTCODE == "-1") {
                        mui.toast(data.DESCRIPTION);
                    } else {
                        mui.toast("系统异常，请重试！");
                    }
                    remDisabled("login");
                    return;
                });
            });

            $("#phone").blur(function() {
                var val = $(this).val();
                if(!booking.validate_mobile(val)) {
                    mui.toast("手机号有误请重试");
                    $(this).val("");
                    phoneCheck = false ;
                    return;
                }
                phoneCheck = true ;
                mui.app_request('POST', {
                    "OPERATE_TYPE": "10076",
                    "MOBILE": val
                }, function(data) {
                    if(data.RESULTCODE == "0") {
                        var is_bind = data.RESULTLIST.is_bind;
                        if(is_bind == 0 || is_bind == "0") {
                            $("#recommend").show();
                        } else {
                            $("#recommend").hide();
                        }
                    }

                }, function(data) {
                    if(data.RESULTCODE == "-1") {
                        mui.toast(data.DESCRIPTION);
                    } else {
                        mui.toast("系统异常，请重试！");
                    }
                });

            })
        })
    </script>
</head>

<body>
<header id="header" class="mui-bar mui-bar-nav">
    <h1 class="mui-title">登录</h1>
</header>
<div class="mui-content">
    <div class="ul">
        <ul class="input-row">
            <li>
                <input id="phone" type="tel" class="mui-input  mui-input-clear" autocomplete="off" maxlength="11" placeholder="请输入手机号" />
            </li>
            <li>
                <input id="recommend" type="tel" style="display: none" class="mui-input  mui-input-clear" autocomplete="off" maxlength="11" placeholder="请输入推荐人电话号码" />
            </li>
            <li>
                <input id="code" type="number" class="mui-input" autocomplete="off" maxlength="4" placeholder="请输入验证码" />
                <button id="up_send" type="button" class="send_code ">发送验证码</button>
            </li>
        </ul>
    </div>
    <div class="xieyi" style="margin-bottom: 20px;">
        <label id="checked" for="checkboxID">
            <span class="checked"></span>
            <span class="login_txt"><input name="checkbox" value="Item" id="checkboxID" type="checkbox"/></span>
            已阅读并勾选
        </label>
        <span class=""><span class="xy" id="fromHerf">《共生网消费者注册协议》</span></span>
    </div>
    <button id="login" type="button" class="mui-btn mui-btn-success mui-btn-block">登录</button>
    <!--<div class="mui-position-bottom" id="bottom">
        <p>服务电话：<a href="tel:023-68179015">023-68179015</a></p>
        <p class="p_2">重庆共生网络技术服务有限公司</p>
    </div>-->
</div>

</body>

</html>