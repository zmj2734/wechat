<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>企业商家资料</title>
		<link rel="stylesheet" type="text/css" href="../../css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="../../css/iconfont.css" />
		<link href="../../css/mui.picker.css" rel="stylesheet" />
		<link href="../../css/mui.poppicker.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../../css/app_new.css" />
		<link href="../../css/city.css" rel="stylesheet" type="text/css">
		<style>
			body {
				background: #fff;
			}
			
			input::-webkit-input-placeholder {
				color: #c0c0c0;
				font-size: 13px;
			}
			
			.mui-content {
				background: #efeff4;
				padding-bottom: 30px;
			}
			
			.mui_input_a {
				font-size: 13px;
				color: #C0C0C0;
				line-height: 50px;
			}
			
			.mui_input_a.basic_00 {
				color: #000;
			}
			
			.mui_input_a.black {
				color: #000;
			}
			
			.mui-input-row label {
				font-size: 14px;
				margin-right: 10px;
			}
			
			.mui-input-row input {
				font-size: 14px;
				padding: 10px 13px;
			}
			
			#requerd {
				top: 0!important;
			}
			
			.intro {
				font-size: 14px;
			}
			
			#icon-card {
				width: 100%;
				height: 100%;
				position: fixed;
				top: 0;
				left: 0;
				background: rgba(0, 0, 0, 0.7);
				z-index: 99;
			}
			
			.icon-card-img {
				width: 80%;
				height: auto;
				display: inline-table;
				position: absolute;
				left: 0;
				top: 0;
				bottom: 0;
				right: 0;
				margin: auto;
			}
			
			#icon-card-img {
				width: 100%;
				max-width: 100%;
				display: block;
			}
			
			.icon-card-img p {
				line-height: 30px;
				font-size: 16px;
				color: #fff;
				text-align: center;
			}
			
			.ml-10 {
				margin-left: 10px;
			}
			
			.mui-icon-info {
				font-size: 16px !important;
			}
			
			.photo {
				width: 100%;
				height: auto;
			}
			
			.photo figure {
				width: 30%;
				height: auto;
				background: #f2f2f2;
				display: block;
				float: left;
				margin: 0;
				margin-left: 2.5% !important;
				margin-top: 10px !important;
				position: relative;
			}
			
			.photo figure a {
				width: 100% !important;
				height: auto !important;
				display: block !important;
			}
			
			.photo figure a img {
				width: 100%;
				display: block;
				height: 105px;
			}
			
			#up_img {
				font-size: 130px;
				color: #fff;
				line-height: 105px;
				background: #f2f2f2;
				width: 30%;
				display: inline-block;
				margin-left: 2.5% !important;
				margin-top: 10px !important;
				float: left;
			}
			
			.moren {
				width: 100%;
				height: auto;
				display: block;
				font-size: 12px;
				line-height: 25px;
			}
			
			.img-close {
				position: absolute;
				top: 0px;
				right: 0;
				width: 20px;
				height: 20px;
				background: #fff;
				border-radius: 10px;
				line-height: 20px;
				font-size: 16px;
			}
		</style>
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-nav">
			<a class=" mui-action-back mui-icon mui-icon-left-nav mui-pull-left color" id="back"></a>
			<h1 class="mui-title">加盟商家资料</h1>
		</header>
		<div class="mui-content">
			<form id="formupload" method="post" enctype="multipart/form-data">
				<div class="bus_bg" id="up_imgfile">
					<img src="../../img/realname/bus_license.png" width="400" height="400" class="bus_img" id="license" />
					<input type="hidden" id="img_license" />
					<div class="text-box">
						<div class="text-line">
							<p class="di_size">点击上传营业执照</p>
						</div>
					</div>
				</div>
				<!--<div class="bus_bg" id="bus_upload">
					<div class="photo">
						<div class="my-gallery" id="photo">
							<figure>
								<a href="../../img/fans/fans_img.png" data-size="800x1142"><img src="../../img/fans/fans_img.png" alt="Image description" /></a>
							</figure>
							<figure>
								<a href="../../img/fans/fans_img.png" data-size="800x1142"><img src="../../img/fans/fans_img.png" alt="Image description" /></a>
							</figure>
							<figure>
								<a href="../../img/fans/fans_img.png" data-size="800x1142"><img src="../../img/fans/fans_img.png" alt="Image description" /></a>
							</figure>
						</div>
						<span class="photo_nr" id="up_img">+</span>
					</div>
					<img src="../../img/realname/bus.png" width="400" height="400" class="bus_img" id="shop_img" />
					<input type="hidden" id="img_shop_img" />
					<div class="text-box">
						<div class="text-line">
							<p class="di_size">点击添加企业或者商家门头照</p>
						</div>
					</div>
				</div>-->
				<div class="bus_bg" id="upload_idcard">
					<img src="../../img/realname/realname_idcard.png" width="400" height="400" class="bus_img" id="id_cardimg" />
					<input type="hidden" id="img_id_cardimg" />
					<div class="text-box">
						<div class="text-line">
							<p class="di_size">手持身份证照片
								<a id="a_click" class="red a_click ml-10" href="javascript:;">点击查看示例</a>
							</p>
							<p class="di_size">上传法人或者负责人身份证手持照片</p>
						</div>
					</div>
				</div>
				<div class="bus_bg last_size" id="upload_attorney">
					<img src="../../img/realname/book.png" width="165" height="120" class="bus_img" id="attorney" />
					<input type="hidden" id="img_attorney" />
					<div class="text-box">
						<div class="text-line">
							<p class="di_size">委托书照片</p>
							<p class="di_size">如不是法人本人申请，须提供法人委托书，并加盖公章</p>
						</div>
					</div>
				</div>
			</form>
		</div>
		<div id="icon-card" style="display: none;">
			<div class="icon-card-img">
				<img id="icon-card-img" src="../../img/realname/icon-card-02.png" />
				<p id="icon-tip">请按照示例，上传手持身份证照</p>
			</div>
		</div>
		<div style="margin-top: 23px;">
			<p class="content">查看
				<a id="attorney_mode" class="a_link">&laquo;委托书范本&raquo;</a>
			</p>
			<div style="color: red;margin-left: 10px;"><span><i class="mui-icon mui-icon-info"></i>温馨提示：<span style="color: #999;">加盟商审核时间为工作日9:00 －18:00</span></span>
			</div>
			<button id="requerd" type="button" class="mui-btn mui-btn-success mui-btn-block">提交</button>
		</div>

	</body>
	<script src="../../js/mui.min.js"></script>
	<script src="../../js/mui.picker.js"></script>
	<script src="../../js/mui.poppicker.js"></script>
	<script type="text/javascript" src="../../js/jquery-3.1.0.min.js"></script>
	<script type="text/javascript" src="../../js/common.js"></script>
	<script type="text/javascript" src="../../js/city.data-3.js"></script>
	<script type="text/javascript" src="../../js/exif.js"></script>
	<script type="text/javascript" src="../../js/upload.util.js"></script>
	<script src="../../js/myCity.js" type="text/javascript"></script>
	<script type="text/javascript">
		mui.init({
			swipeBack: true
		});
		var win = null;
		var auid = null;
		var SHOP_NAME = null //商铺名称
		var COMP_NAME = null //法人名称
		var DISTRICT_ID = null //区县
		var BUSINESS_LICENSE_NUM = null //营业执照号码
		var ADDR = null //商铺详细地址
		var SHOP_CATEGORY_ID = null //行业编号
		var DES = null //商铺简介
		var PHONE_NUM = null //联系人电话
		var SHOP_LOGO_URL = null;
		mui.plusReady(function() {

			var isLogin = null;
			mui.app_request("Post", {
				"OPERATE_TYPE": "10081",
				"AUTH_ID": localStorage.getItem("auid"),
			}, function(result) {

				if(result.RESULTCODE == 0) {

					if(result.RESULTLIST.is_login == 1) {

						return;
					} else {
						isLogin = 0;
						mui.alert('您的账号已在其他设备登录，请重新登录。', '安全提示', function() {
							localStorage.removeItem("auid");
							booking.closeAndOpenNewWindow("../login/login.html", "login");
						});
						return;
					}
				}

			}, function(result) {
				if(result.RESULTCODE == -1) {
					isLogin = 0;
					mui.alert('您的账号已在其他设备登录，请重新登录。', '安全提示', function() {
						localStorage.removeItem("auid");
						booking.closeAndOpenNewWindow("../login/login.html", "login");
					});
					return;
				} else {

					return;

				}
			});
			if(isLogin === 0) {
				return;
			}
			auid = localStorage.getItem("auid");
			win = plus.webview.currentWebview();
			SHOP_NAME = win.SHOP_NAME;
			COMP_NAME = win.COMP_NAME;
			DISTRICT_ID = win.DISTRICT_ID;
			BUSINESS_LICENSE_NUM = win.BUSINESS_LICENSE_NUM;
			ADDR = win.ADDR;
			SHOP_CATEGORY_ID = win.SHOP_CATEGORY_ID;
			DES = win.DES;
			PHONE_NUM = win.PHONE_NUM;
			SHOP_LOGO_URL = win.SHOP_LOGO_URL;
			SHOP_HOURS = win.SHOP_HOURS;
			document.getElementById('requerd').addEventListener('tap', function() {
				setDisabled("requerd");

				//商铺营业执照
				var BUSINESS_LICENSE_URL = document.getElementById('img_license').value;
				//获取商家照片
				//var SHOP_LOGO_URL = document.getElementById('img_shop_img').value;
				//获取身份证照片
				var ID_CARD_URL = document.getElementById('img_id_cardimg').value;
				//获取委托书照片
				var PROXY_URL = document.getElementById('img_attorney').value;
				if(mui.isnull(BUSINESS_LICENSE_URL)) {
					mui.toast('请上传商家营业执照!');
					remDisabled("requerd");
					return;
				}
				//				if(mui.isnull(SHOP_LOGO_URL)) {
				//					mui.toast('请上传商家照片!');
				//					remDisabled("requerd");
				//					return;
				//				}
				if(mui.isnull(ID_CARD_URL)) {
					mui.toast('请上传负责人身份证照片!');
					remDisabled("requerd");
					return;
				}
				console.log("SHOP_HOURS:" + SHOP_HOURS)
				mui.app_request('POST', {
					'OPERATE_TYPE': '10083',
					'AUTH_ID': auid,
					'SHOP_NAME': SHOP_NAME, //商铺名称
					'DISTRICT_ID': DISTRICT_ID, //区县
					'BUSINESS_LICENSE_URL': BUSINESS_LICENSE_URL, //营业执照url
					'BUSINESS_LICENSE_NUM': BUSINESS_LICENSE_NUM, //营业执照号码
					'ADDR': ADDR, //商铺详细地址
					'SHOP_CATEGORY_ID': SHOP_CATEGORY_ID, //行业编号 
					'DES': DES, //商铺简介
					'PROXY_URL': PROXY_URL, //委托书照片     可为空
					'ID_CARD_URL': ID_CARD_URL, //身份证照片
					'SHOP_LOGO_URL': SHOP_LOGO_URL, //商铺照片
					'PHONE_NUM': PHONE_NUM, //联系人电话
					'CONTACTS': COMP_NAME,
					'LEGAL_NAME': COMP_NAME,
					"SHOP_HOURS": SHOP_HOURS,
				}, function(data) {
					if(data.RESULTCODE == '0') {
						mui.toast("提交成功,请耐心等待审核");
						booking.closeAndOpenNewWindow("mine.html", "mine");
					}
					remDisabled("requerd");
				}, function(result) {
					if(result.RESULTCODE == "-1") {
						mui.toast(result.DESCRIPTION);
						return;
					}
					remDisabled("requerd");
					mui.toast("系统异常，请重试");
					return;
				});
			});
		});
		mui(".mui-content").on('tap', '.bus_img', function() {

			var ids = this.id;
			if(mui.os.plus) {
				var a = [{
					title: "拍照"
				}, {
					title: "从手机相册选择"
				}];
				plus.nativeUI.actionSheet({
					title: "上传图片",
					cancel: "取消",
					buttons: a
				}, function(b) { /*actionSheet 按钮点击事件*/

					switch(b.index) {
						case 0:
							break;
						case 1:
							getImage(1000, 800, ids, "sphotos", uploadSucess); /*拍照*/
							break;
						case 2:
							galleryImg(1000, 800, ids, "sphotos", uploadSucess); /*打开相册*/
							break;
						default:
							break;
					}
				});
			}
		}, false);
		document.getElementById("a_click").addEventListener('tap', function() {
			$("#icon-card").show();
		})
		document.getElementById("icon-card").addEventListener('tap', function() {
			$(this).hide();
		});
		document.getElementById('attorney_mode').addEventListener('tap', function() {
			mui.openWindow({
				'id': 'attorney_exp',
				url: 'attorney_exp.html'
			});
		})
		/*图片开始*/
		function uploadSucess(data, id) {
			$("#img_" + id).val(data.RESULTLIST.PATH);
			commom_url = booking.constants.ip + data.RESULTLIST.PATH;
			document.getElementById(id).src = commom_url;
		}
	</script>

</html>