<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>我的收益</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../../css/app_new.css" />
		<link rel="stylesheet" type="text/css" href="../../css/iconfont.css" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<style type="text/css">
			.c_pro {
				padding-top: 0;
				margin-top: -14px;
			}
			/*.with_content{
				height: auto; 
			}*/
		</style>
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/common.js"></script>
		<script src="../../js/jquery-3.1.0.min.js" type="text/javascript"></script>
		<script type="text/javascript">
			mui.init({
				swipeBack:true,
				pullRefresh: {
					container: '#pullrefresh',
					up: {
						contentrefresh: "正在刷新...",
						callback: pulldownRefresh
					}
				}
			});
			var list_num = 0;
			var auid = null;
			var size = 10;
			mui.plusReady(function() {
				var u = navigator.userAgent;
				var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
				var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端

				if(isAndroid == true) {
					var height = document.body.clientHeight;
					$("#body_margin").css('margin-top', -80 + "px");
					$("#pullrefresh").css('height', height - 164 + "px");
					$("#pullrefresh").css('margin-top', 210 + "px");
					$("#pullrefresh").css('overflow', 'auto');
				}
				if(isiOS == true) {
					var height = document.body.clientHeight;
					$("#pullrefresh").css('overflow', ' hidden');
					$("#pullrefresh").css('height', height - 134 + "px");
					$("#pullrefresh").css('margin-top', 180 + "px");
					$("#body_margin").css('margin-top', -50 + "px");
				}

				auid = localStorage.getItem("auid");
				if(!auid) {
					$("#nomessage").css("display", "block");
					mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);
					return;
				}
				mui.app_request('POST', {
						"OPERATE_TYPE": "10057",
						"AUTH_ID": auid, //localStorage.getItem("auid")
						"BEGIN": list_num,
						"SIZE": size
					}, function(data) {
						if(data.RESULTCODE == "0") {
							$("#total_amonut").html(data.RESULTLIST.total_amount);
							var banlist = data.RESULTLIST.result;
							if(banlist.size == 0) {
								$("#nomessage").css("display", "block");
								mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);
							}
							addlistNO(banlist);
							list_num = list_num + size;
							return;
						}
					},
					function(result) {
						if(result.RESULTCODE == "-1") {
							mui.toast(result.DESCRIPTION);
							return;
						} else {
							mui.toast("系统异常，请重试");
							return;
						}
					});
			});

			function pulldownRefresh() {
				setTimeout(function() {
					auid = localStorage.getItem("auid")
					if(!auid) {
						$("#nomessage").css("display", "block");
						mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);
						return;
					}
					mui.app_request('POST', {
							"OPERATE_TYPE": "10057",
							"AUTH_ID": auid,
							"BEGIN": list_num,
							"SIZE": size
						}, function(data) {
							if(data.RESULTCODE == "0") {
								var banlist = data.RESULTLIST.result;

								addlistNO(banlist);
								list_num = list_num + size;
								if(banlist.length < size) {
									mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);
								} else {
									//alert(123)
									mui('#pullrefresh').pullRefresh().endPullupToRefresh(false);
								}
								return;
							}
						},
						function(result) {
							if(result.RESULTCODE == "-1") {
								mui.toast(result.DESCRIPTION);
								return;
							} else {
								mui.toast("系统异常，请重试");
								return;
							}
						});
				}, 1500);
			}

			function addlistNO(datas) { 
				var _html = "";
				for(var i = 0; i < datas.length; i++) {
					_html += '<div class="with_content">';
					_html += '<div class="left_time">';
					_html += '<p><span class="sub_type">' + datas[i].des + '</span></p>';
					_html += '<span><span class="get_time">' + datas[i].create_time + '</span></span>';
					_html += '</div>';
					_html += '<div class="fr">';
					_html += '<p><span class="profit">' + datas[i].amount + '</span></p>';
					_html += '</div>';
					_html += '</div>';
				}
				//list_num++;

				$("#profit").append(_html);
			}

			function dateUtil(a) {
				return a.substring(0, 10);
			}
		</script>
	</head>

	<body style="border: 1px rgba(000,000,000,0) solid;" id="body_margin">

		<header id="header" class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left color" id="back"></a>
			<h1 class="mui-title">我的补贴</h1>
		</header>
		<div class="mui-content mui-scroll-wrapper" style="z-index: 4;position:fixed;top: 0;left: 0;width: 100%;height: 130px;">
			<div class="c_pro">
				<p class="c_txt">累计补贴(元)</p>
				<p class="get" id="total_amonut"></p>
			</div>
		</div>
		<!--<div class="with_content">
			<div class="left_time">
				<p><span class="sub_type">余额提现</span></p>
				<span><span class="get_time">2017-02-17</span></span>
			</div>
			<div class="fr">
				<p><span class="profit">-94.00</span></p>
			</div>
		</div>-->
		<div id="pullrefresh">
			<div class="mui-scroll">
				<div id="profit">
					<!--<div class="with_content">
						<div class="left_time">
							<p><span class="sub_type">123123</span></p>
							<span><span class="get_time">123123</span></span>
							</div>
							<div class="fr">
							<p><span class="profit">3213</span></p>
						</div>
					</div>
					<div class="with_content">
						<div class="left_time">
							<p><span class="sub_type">123123</span></p>
							<span><span class="get_time">123123</span></span>
							</div>
							<div class="fr">
							<p><span class="profit">3213</span></p>
						</div>
					</div>
					<div class="with_content">
						<div class="left_time">
							<p><span class="sub_type">123123</span></p>
							<span><span class="get_time">123123</span></span>
							</div>
							<div class="fr">
							<p><span class="profit">3213</span></p>
						</div>
					</div>
					<div class="with_content">
						<div class="left_time">
							<p><span class="sub_type">123123</span></p>
							<span><span class="get_time">123123</span></span>
							</div>
							<div class="fr">
							<p><span class="profit">3213</span></p>
						</div>
					</div>-->
				</div>
			</div>
		</div>

	</body>

</html>