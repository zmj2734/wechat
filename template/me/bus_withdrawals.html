<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>商家提现</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="../../css/app_new.css" />
		<link rel="stylesheet" type="text/css" href="../../css/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../../css/in_pwd.css" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<style type="text/css">
			.bus_with_info {
				height: auto !important;
			}
			
			.with_info {
				width: 100%;
				height: auto;
				display: block;
			}
			
			.with_info p {
				line-height: 40px !important;
				font-size: 14px !important;
				margin-left: 0 !important;
				margin-top: 0;
				text-indent: 10px;
				border-bottom: 1px solid #ccc;
				color: #333 !important;
			}
			
			.w_money {
				width: 100%;
				margin-top: 10px;
				display: inline-block;
			}
			
			.bus_with_info {
				margin-top: 45px;
			}
			
			#fund {
				font-size: 14px !important;
			}
		</style>
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left color" id="back"></a>
			<h1 class="mui-title">商家余额提现</h1>
			<button class="mui-btn mui-btn-blue mui-icon mui-icon-help mui-btn-link mui-pull-right" id="detail" style="padding-top: 0;"></button>
		</header>
		<div class="bus_with_info fl">
			<div class="with_info fl">
				<p class="name">收款账户名：<span id="pay_getnum"></span></p>
				<p class="phone">收款账号：<span id="id_card"></span></p>
				<p class="phone">收款开户行：<span id="open_bank"></span></p>
			</div>
			<p class="w_money">提现金额</p>
			<p class="w_num">&yen;<input class="wide_price" id="fund" type="number" placeholder="提现金额须是100的倍数"></input>
			</p>
		</div>
		<div style="color: red;margin-left: 10px;"><span>温馨提示：</span>1、提现审核时间为工作日9:00 －18:00；</div>
		<div style="color: red;margin-left: 10px;text-indent: 60px;">2、平台将在1-3个工作日内处理提现请求；</div>
		<button id="commit" type="button" class="mui-btn mui-btn-success mui-btn-block com_btn">确认</button>
		<script src="../../js/mui.min.js"></script>
		<script type="text/javascript" src="../../js/common.js"></script>
		<script type="text/javascript" src="../../js/jquery-3.1.0.min.js"></script>
		<script src="../../js/passwordBox.min.js"></script>
		<script type="text/javascript">
			mui.init({
				swipeBack: true
			});
			var auid = null;
			mui.plusReady(function() {

						auid = localStorage.getItem("auid");
						
						var isLogin = null;
						mui.app_request("Post", {
							"OPERATE_TYPE": "10081",
							"AUTH_ID": localStorage.getItem("auid"),
						}, function(result) {

							if(result.RESULTCODE == 0) {

								if(result.RESULTLIST.is_login == 1) {

									return;
								} else {
									isLogin = 0;
									mui.alert('您的账号已在其他设备登录，请重新登录。', '安全提示', function() {
										localStorage.removeItem("auid");
										booking.closeAndOpenNewWindow("../login/login.html", "login");
									});
									return;
								}
							}

						}, function(result) {
							if(result.RESULTCODE == -1) {
								isLogin = 0;
								mui.alert('您的账号已在其他设备登录，请重新登录。', '安全提示', function() {
									localStorage.removeItem("auid");
									booking.closeAndOpenNewWindow("../login/login.html", "login");
								});
								return;
							} else {

								return;

							}
						});
						if(isLogin === 0) {
							return;
						}
						if(!PwdBox.inited) {
							PwdBox.init('', '../../img/pwd_keyboard.png', '请输入支付密码', '安全支付环境，请放心使用！');
							$(".notice").html("<p>安全支付环境，请放心使用！</p><a id='forget' class='forget'>忘记密码?</a>")
						}
						document.getElementById("forget").addEventListener('tap', function() {
							booking.closeAndOpenNewWindow("find_pwd.html", "find_pwd")
						})
						document.getElementById("detail").addEventListener('tap', function() {
							booking.closeAndOpenNewWindow("withdrawls_exp.html", "withdrawls_exp")
						});
						document.getElementById("commit").addEventListener('tap', function() {
							setDisabled("commit");
							PwdBox.show(function(res) {
								//console.log(JSON.stringify(res)) 
								if(res.status) {
									//重置输入
									var pay_pwd = res.password;
									console.log(pay_pwd)
									mui.app_request('POST', {
										"OPERATE_TYPE": "10082",
										"AUTH_ID": auid, //localStorage.getItem("auid"),
										"PAY_PWD": pay_pwd,
									}, function(data) {
										console.log("000:" + JSON.stringify(data))
										if(data.RESULTCODE == "0") {
											if(data.RESULTLIST.is_ok == 1) {
												bus_append_fund()
											} else {
												mui.toast("密码错误！");
												return;
											}
										}
									}, function(result) {
										console.log(JSON.stringify(result))
										mui.toast(result.DESCRIPTION);
									});
								} else {
									PwdBox.reset();
									remDisabled("toappend");
									//alert(JSON.stringify(arguments));
								}

							})
							//				document.getElementById("detail").addEventListener('tap', function() {
							//					mui.openWindow({
							//						id: 'bus_withdetail',
							//						url: 'bus_withdetail.html'
							//					});
							//				});


							//查询商铺是否绑定银行卡
							mui.app_request("Post", {
								"OPERATE_TYPE": "10056",
								"AUTH_ID": auid, //localStorage.getItem("auid")
							}, function(result) {
								if(result.is_bind == 1) {
									$("#pay_getnum").html(result.shop_bank_account_info.account_name);
									$("#id_card").html(result.shop_bank_account_info.account_num);
									$("#open_bank").html(result.shop_bank_account_info.open_bank_name);
								} else {

								}
								return;
							}, function(result) {
								if(result.RESULTCODE == "-1") {

									mui.toast(result.DESCRIPTION);
								} else {

									mui.toast("系统异常，请重试");
								}
							});

							function bus_append_fund() {
								document.getElementById("fund").blur();
								var fund = parseInt(document.getElementById("fund").value);
								if(mui.isnull(fund)) {
									mui.toast("提现金额不能为空");
									remDisabled("commit");
									return;
								}
								if(fund < 100 || fund % 100 != 0) {
									mui.toast("提现金额最低为100元，且必须是100的倍数。");
									remDisabled("commit");
									return;
								}
								mui.app_request("Post", {
									"OPERATE_TYPE": "10044",
									"AUTH_ID": auid, //localStorage.getItem("auid")
									"AMOUNT": fund,
								}, function(result) {
									mui.toast("申请成功，系统会尽快处理！");
									remDisabled("commit");
									mui.app_back(); //放回businessPageId页面，并且刷新该页面信息
									return;
								}, function(result) {
									remDisabled("commit");
									mui.toast(result.DESCRIPTION);
								})
							}
						})

		</script>
	</body>

</html>